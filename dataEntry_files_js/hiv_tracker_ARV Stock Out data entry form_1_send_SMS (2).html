
<script type="text/javascript">

function sendSMS(){

	//alert("hi hi hi ");
	var tempARVDrugStock = document.getElementById("LUn1yHsc9UY-kdsirVNKdhm-val").value;
	var orgUnitName = document.getElementById("selectedOrganisationUnit").value;
	
	var ou = dhis2.de.getCurrentOrganisationUnit();
	var today  = new Date();
	var todayDate= today.getFullYear() + "-" +("00" + (today.getMonth() + 1)).slice(-2) + "-" + ("00" + (today.getDate())).slice(-2);
		
	var smsText = todayDate + " - " + orgUnitName + " has reported the ARV Stock out";
	console.log( " smsText " + smsText  );
	//alert(tempARVDrugStock + " -- " + ou);
	// last date of year -- `${month.getFullYear()}-${('00' + (month.getMonth() + 1)).slice(-2)}-` + new Date(month.getFullYear(), month.getMonth() + 1, 0).getDate()`;
	if(tempARVDrugStock === "true"){

		
	    //9843064279,9849417564,9864236502
		var tempRecipientsPhoneNumber = [9843064279,9849417564,9864236502];
		var smsParam = {
			//"recipients":tempRecipients,
			"message": smsText,
			"recipients": tempRecipientsPhoneNumber
		};
		
		console.log( " phone no " + tempRecipientsPhoneNumber  );
		console.log( " smsParam " + JSON.stringify(smsParam)  );	
		$.ajax({
			dataType: "json",
			contentType: "application/json",
			url: '../api/sms/outbound',
			data: JSON.stringify(smsParam),
			type: 'POST',
			success: handleSuccess,
			error: handleError
		});

	   function handleSuccess()
	   {
			//alert(" sms send ");
			console.log( " sms send " );
			
	   }

	   function handleError( xhr, textStatus, errorThrown )
	   {
			if ( 409 == xhr.status || 500 == xhr.status ) 
			{
				//xhr.responseText.httpStatus -- 
				//responseText:"{\"httpStatus\":\"Internal Server Error\",\"httpStatusCode\":500,\"status\":\"ERROR\",\"message\":\"no recipient\"}"
				console.log( " ERROR to sms send " + xhr.responseText );
			}
			else // Offline, keep local value
			{
					console.log( " ERROR - to sms send" );
			}
		}
	}
}

//var tempARVDrugStock = document.getElementById("ilJHhsHQ7sA-kdsirVNKdhm-val").value;
</script>

<table border="1" cellpadding="2" cellspacing="2" style="width:700px;">
	<tbody><!--
		<tr>
			<td><span style="font-size:12px;"><span style="color:#000000;"><strong>&nbsp;1. ARV drug stock out for this month?</strong></span></span></td>
			<td><strong><span style="color:#ff0000;"><input id="ilJHhsHQ7sA-kdsirVNKdhm-val" name="entryfield" title="ARV stock out this month_1" value="[ ARV stock out this month_1 ]"/></span></strong></td>
		</tr>
		-->
		<tr>
			<td><span style="font-size:12px;"><span style="color:#000000;"><strong>&nbsp;1. ARV drug stock out for this month?</strong></span></span></td>
			<td><input id="LUn1yHsc9UY-kdsirVNKdhm-val" name="entryfield" title="ARV stock out this month" value="[ ARV stock out this month ]" onchange="sendSMS()" /></td>
		</tr>
		<tr>
			<td colspan="2"><span style="font-size:12px;"><span style="color:#ff0000;"><strong>* if ARV drug stock out for this month is&nbsp;</strong></span><span style="color:#ff0000;"><strong>&quot;Yes&quot;, then answer the following question, if&nbsp; &quot;No&quot; just click complete</strong></span></span></td>
		</tr>
		<tr>
			<td><span style="font-size:12px;"><strong>2. Select the stock out ARV drug from dropdown list below</strong></span></td>
			<td><span style="font-size:12px;"><strong>3. Mention number of stock out days for ARV drug</strong></span></td>
		</tr>
		<tr>
			<td><strong>a.&nbsp; &nbsp;<input id="xAsuBxx3QTB-kdsirVNKdhm-val" name="entryfield" title="Name of ARV Drug row1" value="[ Name of ARV Drug row1 ]" /></strong></td>
			<td><input id="uaw32bSKGha-kdsirVNKdhm-val" name="entryfield" title="Number of stock out days row1" value="[ Number of stock out days row1 ]" /></td>
		</tr>
		<tr>
			<td><strong>b.&nbsp; &nbsp;<input id="WzvnebWPMtO-kdsirVNKdhm-val" name="entryfield" title="Name of ARV Drug row2" value="[ Name of ARV Drug row2 ]" /></strong></td>
			<td><input id="RiagvKBN4Py-kdsirVNKdhm-val" name="entryfield" title="Number of stock out days row2" value="[ Number of stock out days row2 ]" /></td>
		</tr>
		<tr>
			<td><strong>c.&nbsp; &nbsp;<input id="e8tlxVn4eNr-kdsirVNKdhm-val" name="entryfield" title="Name of ARV Drug row3" value="[ Name of ARV Drug row3 ]" /></strong></td>
			<td><input id="XXlNmcw2Y2t-kdsirVNKdhm-val" name="entryfield" title="Number of stock out days row3" value="[ Number of stock out days row3 ]" /></td>
		</tr>
		<tr>
			<td><strong>d.&nbsp; &nbsp;<input id="qtbwjhEuXLC-kdsirVNKdhm-val" name="entryfield" title="Name of ARV Drug row4" value="[ Name of ARV Drug row4 ]" /></strong></td>
			<td><input id="T4liSOoyE9T-kdsirVNKdhm-val" name="entryfield" title="Number of stock out days row4" value="[ Number of stock out days row4 ]" /></td>
		</tr>
		<tr>
			<td><strong>e.&nbsp; &nbsp;<input id="ITwGMWo1uul-kdsirVNKdhm-val" name="entryfield" title="Name of ARV Drug row5" value="[ Name of ARV Drug row5 ]" /></strong></td>
			<td><input id="bgPExvA7F0d-kdsirVNKdhm-val" name="entryfield" title="Number of stock out days row5" value="[ Number of stock out days row5 ]" /></td>
		</tr>
	</tbody>
</table>
<p>&nbsp;</p>

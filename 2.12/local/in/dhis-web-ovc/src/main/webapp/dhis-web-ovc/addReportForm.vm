
<style>
    #overlay {
    z-index:9998;
    position:absolute;
    top:0;
    bottom:0;
    left:0;
    width:100%;
    background:#000;
    opacity:0.45;
    -moz-opacity:0.45;
    filter:alpha(opacity=45);
    visibility:hidden;   
    }
    #overlayImg{ width: 50px; height: 50px; z-index: 9999; position: absolute; left:50%}
</style>
<div id="overlay">
    <div id="overlayImg"><img  width="50" height="50" src="images/ajax-loader.gif" style="margin:auto;position:fixed;top: 50%;left: 50%;"/></div>
</div>

## Macro for generating the jQuery validation rules 
#macro( validate $type $require )
  #if( $type == "NUMBER" )
    {validate:{ number:true #if($require), required:true #end }}
  #elseif( $require )
    {validate:{required:true}}
  #end
#end


<script>
    
	jQuery(document).ready( function(){
	currentDiv = 'addReportForm';
	isSubmit = true;
    jQuery("#addReportForm").validate({
		meta:"validate"
		,errorElement:"span"
		,submitHandler: function(form)
		{
        	if( isSubmit ) 
            {	
            	alert("submit");
            	saveCustomReport();
            }
		}
    	});
    }); 
    
</script>


<form id="addReportForm" name = "addReportForm" method="post">
<div id="tabs" style="width:80%; height:450px; align:center" >

	<ul>
		<li><a href="#tab-1">$i18n.getString("person_properties")</a></li>
		<!--<li><a href="#tab-2">$i18n.getString("program")</a></li>-->
		<li><a href="#tab-3">$i18n.getString("advance_filter")</a></li>
	</ul>


	#if( $patientAttributes && $patientAttributes.size() > 0  )
		
		<div id="tab-1">
			<table>
				<tr>
					<th>$i18n.getString( "person_details" )</th>
					<th></th>
					<th>$i18n.getString( "selected_person_details" )</th>
				</tr>
				<tr>
					<td>
						<select multiple="multiple" id="availablePersonProperties" name="availablePersonProperties" size="9"  ondblclick="moveSelectedById( 'availablePersonProperties', 'selectedPersonProperties' )" style="width:325px; height:125px">
							<option value="PP_firstname">$i18n.getString( "firstname" )</option>
							<option value="PP_middlename">$i18n.getString( "middlename" )</option>
							<option value="PP_lastname">$i18n.getString( "lastname" )</option>
							<option value="PP_fullname">$i18n.getString( "fullname" )</option>
							<option value="PP_age">$i18n.getString( "age" )</option>
							<option value="PP_birthdate">$i18n.getString( "birthdate" )</option>
							<option value="PP_gender">$i18n.getString( "gender" )</option>
							<option value="PP_registrationdate">$i18n.getString( "registrationdate" )</option>
							<option value="PP_identifier">$i18n.getString( "identifier" )</option>
						</select>
					</td>
					<td>
						<input type="button" value="&gt;" style="width:40px" onClick="moveSelectedById( 'availablePersonProperties', 'selectedPersonProperties' )"><br/>
						<input type="button" value="&lt;" style="width:40px" onClick="moveSelectedById( 'selectedPersonProperties', 'availablePersonProperties' )"><br/>
						<input type="button" value="&gt;&gt;" style="width:40px" onClick="moveAllById( 'availablePersonProperties', 'selectedPersonProperties' )"><br/>
						<input type="button" value="&lt;&lt;" style="width:40px" onClick="moveAllById( 'selectedPersonProperties', 'availablePersonProperties' )">
					</td>
					<td>
						<select multiple="multiple" id="selectedPersonProperties" name="selectedPersonProperties" size="9" ondblclick="moveSelectedById( 'selectedPersonProperties', 'availablePersonProperties' )" style="width:325px; height:125px" class="{validate:{required:true}}"/></select>
					</td>
					<!--
					<td>
						<a href="javascript:moveUpSelectedOption( 'selectedPersonProperties')" title="$i18n.getString( 'move_up' )"><img src="../images/move_up.png" alt="$i18n.getString( 'move_up' )"/></a><br/><br/>
						<a href="javascript:moveDownSelectedOption( 'selectedPersonProperties' )" title="$i18n.getString( 'move_down' )"><img src="../images/move_down.png" alt="$i18n.getString( 'move_up' )"/></a>
					</td>
					-->
				</tr>  				

			    <tr>
					<td>&nbsp;</td>
					<td>&nbsp;</td>
					<td>&nbsp;</td>
			    </tr>
                <tr>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                </tr>
			    
				<tr>
					<th>$i18n.getString( "person_attributes" )</th>
					<th></th>
					<th>$i18n.getString( "selected_person_attributes" )</th>
				</tr>
				<tr>
					<td>
						<select multiple="multiple" id="availablePatientAttributes" name="availablePatientAttributes" size="9" ondblclick="moveSelectedById( 'availablePatientAttributes', 'selectedPatientAttributes' )"  style="width:325px; height:125px">
							#foreach ( $patientAttribute in $patientAttributes )
								<option value="PA_$patientAttribute.id" title="$patientAttribute.name">$patientAttribute.name</option>
							#end
						
						</select>
					</td>
					<td>
						<input type="button" value="&gt;" style="width:40px" onClick="moveSelectedById( 'availablePatientAttributes', 'selectedPatientAttributes' )"><br/>
						<input type="button" value="&lt;" style="width:40px" onClick="moveSelectedById( 'selectedPatientAttributes', 'availablePatientAttributes' )"><br/>
						<input type="button" value="&gt;&gt;" style="width:40px" onClick="moveAllById( 'availablePatientAttributes', 'selectedPatientAttributes' )"><br/>
						<input type="button" value="&lt;&lt;" style="width:40px" onClick="moveAllById( 'selectedPatientAttributes', 'availablePatientAttributes' )">
					</td>
					<td>
						<select multiple="multiple" id="selectedPatientAttributes" name="selectedPatientAttributes" size="9" ondblclick="moveSelectedById( 'selectedPatientAttributes', 'availablePatientAttributes' )"  style="width:325px; height:125px"></select>
					</td>
					<!--
					<td>
						<a href="javascript:moveUpSelectedOption( 'selectedPatientAttributes')" title="$i18n.getString( 'move_up' )"><img src="../images/move_up.png" alt="$i18n.getString( 'move_up' )"/></a><br/><br/>
						<a href="javascript:moveDownSelectedOption( 'selectedPatientAttributes' )" title="$i18n.getString( 'move_down' )"><img src="../images/move_down.png" alt="$i18n.getString( 'move_up' )"/></a>
					</td>
					-->
				</tr>  				

							
			</table>
		</div>	
	#end
	<!--
	<div id="tab-2">
		PROGRAM
	</div>
	-->
	<div id="tab-3">
	
		<table>	
			<tr>
				<th colspan="4">$i18n.getString( "person_attributes_filter" )</th>
				
			</tr>			
			
			
			<tr>
				<td id='searchingAttributeIdTD'style='display:none'>
				  <select class='search-field' id="searchObjectId" name="searchObjectId" #if( $patientAttributes.size() == 0 ) disabled="disabled" #end onchange="searchObjectOnChange(this)">
					<option value="iden">$i18n.getString( "search_by_name_identifier" )</option>
					<!--<option value="prg">$i18n.getString( "search_by_program" )</option>-->
					<option value="fixedAttr_birthDate">$i18n.getString( "birthdate" )</option>
					<option value="fixedAttr_age">$i18n.getString( "age_year" )</option>
					<option value="fixedAttr_gender">$i18n.getString( "gender" )</option>
					<option value="fixedAttr_phoneNumber">$i18n.getString( "phone_number" )</option>
					#foreach( $attribute in $patientAttributes )
						<option value="attr_$attribute.id" valueType='$attribute.valueType'>$encoder.htmlEncode( $attribute.displayName )</option>
					#end
				  </select>
				</td>
			</tr>
			
		<tbody id='advancedSearchTB'>
			<tr>
				<td></td>
				<td></td>
				<td name='addAndSearchBtn' rowspan='2' valign='bottom'>
					<input type="button" class='normal-button' value='$i18n.getString( "add" )' onclick='addAttributeOption();'>
				</td>				
			</tr>
			<tr id='advSearchBox0'>	       
				<td>
				  <select class='search-field' id="searchObjectId" name="searchObjectId" #if( $patientAttributes.size() == 0 ) disabled="disabled" #end onchange="searchObjectOnChange(this)">
					<option value="iden">$i18n.getString( "search_by_name_identifier" )</option>
					<!--<option value="prg">$i18n.getString( "search_by_program" )</option>-->
					<option value="fixedAttr_birthDate">$i18n.getString( "date_of_birth" )</option>
					<option value="fixedAttr_age">$i18n.getString( "age_year" )</option>
					<option value="fixedAttr_gender">$i18n.getString( "gender" )</option>
					<option value="fixedAttr_phoneNumber">$i18n.getString( "phone_number" )</option>
					#foreach( $attribute in $patientAttributes )
						<option value="attr_$attribute.id" valueType='$attribute.valueType'>$encoder.htmlEncode( $attribute.displayName )</option>
					#end
				  </select>
				  
				</td>		
				<td>
					<input type="text" id="searchText" name="searchText" value="$!searchText" style='width:200px;'>
					<input type="button" class='normal-button' name="clearSearchBtn" value='$i18n.getString( "clear" )' onclick="removeAttributeOption('advSearchBox0');" disabled>
				</td>
			</tr>
		</tbody>			
			
		</table>
		
		
	</div>	
	
</div>

<!--
<table>
	<tr>
		<th>$i18n.getString( "person_properties" )</th>
		<th>$i18n.getString( "program_dataElements" )</th>
		<th>$i18n.getString( "advance_filter" )</th>
	</tr>
	<tr>
		<td>
			<select multiple="multiple" id="displaysSlectedPersonPropertiesAttributes" name="displaysSlectedPersonPropertiesAttributes" size="7" style="width:235px; height:100px">
			</select>
		</td>
		<td>
			<select multiple="multiple" id="displaySelectedProgramDataElements" name="displaySelectedProgramDataElements" size="7" style="width:235px; height:100px">
			</select>
		</td>
		<td>
			<select multiple="multiple" id="displaySelectedAdvancedFilter" name="displaySelectedAdvancedFilter" size="7"  style="width:235px; height:100px" ></select>
		</td>
	</tr>
</table>
-->	 				
<div align="left">
	<p>	
		<input type="button" style='width:100px' value="$i18n.getString( 'save' )" onclick='nameAndSortOrderForCustomReport();'/>&nbsp;&nbsp;
		<input type="button" style='width:100px' value="$i18n.getString( 'preview' )" onclick='openReportPreviewWindow();'/>&nbsp;&nbsp;
		<input type="button" style='width:100px' value="$i18n.getString( 'cancel' )" onClick="window.location.href='customReportManagement.action'" />
	</p>
</div>

<!--<div id="orgUnitPeriodtDiv"></div>-->

<div id="reportNameAndSortOrderDesignDiv">
	<table>
	    <tr>
	        <td><strong>$i18n.getString( "report_name" )</strong><em title="$i18n.getString( 'required' )" class="required">*</em></label></td>
	        <td><input type="text" id="reportName" name="reportName" style="width:200px" class="{validate:{required:true, unicodechars:true}}"/></td>
	  	</tr>
	  	
	  	<tr>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
	    </tr>
	    
	    
	  	<tr> 
	        <td><strong>$i18n.getString('available_for_all')</strong></td> 
			<td><input type='checkbox' id='reportAvailabeForAll' name='reportAvailabeForAll' /></td>
	    </tr>
	    <tr>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
	    </tr>    
		<tr>
			
			<td valign="top"><strong>$i18n.getString( "selected_details" )</strong></td>
			<td>
				<select multiple="multiple" id="displaysSlectedPersonPropertiesAndAttributes" name="displaysSlectedPersonPropertiesAttributes" size="10" style="width:200px; height:200px">
				</select>
			</td>
	
			<td>
				<a href="javascript:moveUpSelectedOption( 'displaysSlectedPersonPropertiesAndAttributes')" title="$i18n.getString( 'move_up' )"><img src="../images/move_up.png" alt="$i18n.getString( 'move_up' )"/></a><br/><br/>
				<a href="javascript:moveDownSelectedOption( 'displaysSlectedPersonPropertiesAndAttributes' )" title="$i18n.getString( 'move_down' )"><img src="../images/move_down.png" alt="$i18n.getString( 'move_up' )"/></a>
			</td>
		</tr>
	</table>
		
	<div align="left">
		<p>	
			<input type="button" style='width:100px' value="$i18n.getString( 'save' )" onclick='validateAddCustomReport();'/>&nbsp;&nbsp;
			<input type="button" style='width:100px' value="$i18n.getString( 'cancel' )" onClick="closeDialogReportName();" />
		</p>
	</div>
		
</div>


<div id="reportPreviewDiv">
	<table>
		<tr>
			<td valign="top"><strong>$i18n.getString( "selected_details" )</strong></td>
			<td>
				<select multiple="multiple" id="displaysSlectedPersonPropertiesAndAttributesForPreview" name="displaysSlectedPersonPropertiesAndAttributesForPreview" size="10" style="width:200px; height:200px" class="{validate:{required:true}}"/></td>
				</select>
			</td>
	
			<td>
				<a href="javascript:moveUpSelectedOption( 'displaysSlectedPersonPropertiesAndAttributesForPreview')" title="$i18n.getString( 'move_up' )"><img src="../images/move_up.png" alt="$i18n.getString( 'move_up' )"/></a><br/><br/>
				<a href="javascript:moveDownSelectedOption( 'displaysSlectedPersonPropertiesAndAttributesForPreview' )" title="$i18n.getString( 'move_down' )"><img src="../images/move_down.png" alt="$i18n.getString( 'move_up' )"/></a>
			</td>
		</tr>
	</table>
	<br />
	<table>    
		<tr>
			<td><strong>$i18n.getString( "start_date" )</strong></td>
			<td>
				<input type="text" id="startDate" name="startDate"  class="{validate:{required:true}}"  />
        			<script type="text/javascript">
            			datePickerValid( 'startDate', false );
        			</script>					
			</td>
			<td>&nbsp;</td>
			<td><strong>$i18n.getString( "end_date" )</strong></td>
			<td>
				<input type="text" id="endDate" name="endDate" class="{validate:{required:true}}" />
        			<script type="text/javascript">
            			datePickerValid( 'endDate', false );
        			</script> 					
			</td>
		</tr>	    
	   <br />
		<tr>
			<td><strong>$i18n.getString( "orgUnit_group" )</strong></td>
			<td>
				<select id="orgUnitGroupId" name="orgUnitGroupId" style="width:180px">
					<option value="0">[ $i18n.getString( "select_orgUnit_Group" ) ]</option>
					#foreach( $orgUnitgroup in $orgUnitGroups )
						<option value="$orgUnitgroup.id">$orgUnitgroup.name</option>
					#end
	
				</select>			
			</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>	    	   
	   
	</table>
	
	<br />
	
<!--	
  <table id="selectionTable">
	<tr>
	  <td>
		#organisationUnitSelectionTree( false, true, false )
	  </td>
    </tr>
  </table>
-->  
	<div align="left">
		<p>	
			<input type="button" style='width:100px' value="$i18n.getString( 'preview' )" onclick='validateReportPreview();'/>&nbsp;&nbsp;
			<input type="button" style='width:100px' value="$i18n.getString( 'cancel' )" onClick="closeReportPreviewDialog();" />
		</p>
	</div>
		
</div>

</form>
<div id="reportPreviewResultDiv"><div id="previewDataContentDiv"></div></div>
	
##parse( "/dhis-web-ovc/nameBasedReportOutput.vm" )
	
</div>


<script type="text/javascript">
	$('#tabs').tabs();
	
	var i18n_male = '$encoder.jsEscape( $i18n.getString( "male" ) , "'")';
	var i18n_female = '$encoder.jsEscape( $i18n.getString( "female" ) , "'")';
	var i18n_yes = '$encoder.jsEscape( $i18n.getString( "yes" ) , "'")';
	var i18n_no = '$encoder.jsEscape( $i18n.getString( "no" ) , "'")';
	var i18n_clear = '$encoder.jsEscape( $i18n.getString( "clear" ) , "'")';
	
	var searchTextBox = '<input type="text" id="searchText" name="searchText"  style="width:202px;">';
</script>
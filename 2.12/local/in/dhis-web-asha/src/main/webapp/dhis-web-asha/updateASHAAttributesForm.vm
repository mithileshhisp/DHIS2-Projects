
#macro( validate $type $require )
  #if( $type == "NUMBER" )
  	{validate:{ number:true #if($require), required:true #end }}
  #elseif( $type == "string" )
  	{validate:{ alphanumeric:true #if($require), required:true #end }}
  #elseif( $require )
  	{validate:{required:true}}
  #end
#end

<script>
    jQuery(document).ready( function(){

        currentDiv = 'updateASHAAttributesForm';
        isSubmit = true;
        //alert( "inside update validation");
        jQuery("#updateASHAAttributesForm").validate({
                 meta:"validate"
                ,errorElement:"span"
                ,submitHandler: function(form)
                    {
                    	//alert( "inside update validation after");
                        if( isSubmit ) 
                        {
                            updateASHAAttributes();
                        }
                    }
            });
    }); 
    
</script>

<h4>$i18n.getString( "update_asha_attribute" ) $!attributeGroup.name  $i18n.getString( "details" )</h4>
<p>
<form id="updateASHAAttributesForm" name="updateASHAAttributesForm" method="post" >

<input type="hidden" id="attributeGroupId" name="attributeGroupId" value="$attributeGroup.id">
<input type="hidden" id="attributeGroupName" name='attributeGroupName' value="$!attributeGroup.name"/>
<input type="hidden" id="id" name="id" value="$patient.id">

<table>		
	<tr>
		<th colspan="2" class="heading-column">$i18n.getString( "system_identifier" )</th>
	</tr>	
	<tr>
		<td></td>
		<td>$!systemIdentifier</td>
	</tr>
	<tr>
		<td>&nbsp;</td>
	</tr>	

	<tr>
		<th colspan="2" class="heading-column">$i18n.getString( "details" )</th>
	</tr>
	
	<tr>
		<td>$i18n.getString("full_name")</td>
		<td>$encoder.htmlEncode($!patient.getFullName())</td>
	</tr>
	
	<tr>
		<td>$i18n.getString("location")</td>
		<td>$encoder.htmlEncode($!patient.organisationUnit.name)</td>
	</tr>
	
	<tr>
		<td>$i18n.getString("gender")</td>
		<td>$i18n.getString($!patient.gender)</td>
	</tr>

	<tr>
		<td>$i18n.getString("date_of_birth")</td>
		<td>$format.formatDate( $!patient.birthDate) ($!patient.getAge())</td>
	</tr>
	
	<tr>
		<td>$i18n.getString("phone_number")</td>
		<td>
			#if($!patient.phoneNumber && $!patient.phoneNumber!='')
				$!patient.phoneNumber
			#else
				[$i18n.getString('none')]
			#end
		</td>
	</tr>
	
<!-- ATTRIBUTES IN GROUPS -->
	#if( $!attributeGroup )
		<tr><td>&nbsp;</td></tr>	
		#if( $!attributeGroups.size() > 0 )
			#foreach ($attributeGroup in $attributeGroups )
				<tr><td>&nbsp;</td></tr>
				<tr><th colspan="2" class="heading-column">$attributeGroup.displayName</th></tr>
				#set($attributes = $attributeGroupsMap.get($attributeGroup.id))
				#foreach($attribute in $attributes )
					#if( $!attribute && $attribute.program )
					#elseif( $!attribute )
						#set( $attributeValue = "" )
						#set( $attributeValue = $!patientAttributeValueMap.get( $attribute.id ) )
						<tr>
							<td class='text-column'><label>$attribute.name #if($attribute.mandatory)<em title="$i18n.getString( "required" )" class="required">*</em> #end</label></td>
							<td class="input-column">
								#if( $attribute.valueType == "YES/NO" )
									<select id="attr$attribute.id"  name="attr$attribute.id" >              
										<option value="">[$i18n.getString( "please_select" )]</option>
										<option value="true" #if( $attributeValue=='true') selected="selected" #end>$i18n.getString( "yes" )</option>
										<option value="false" #if( $attributeValue=='false') selected="selected" #end>$i18n.getString( "no" )</option>
									</select>                
								#elseif( $attribute.valueType == "DATE" )
									<input type="text" id="attr$attribute.id" name="attr$attribute.id" value="$!attributeValue" class=' #validate( "default"  $attribute.mandatory )'>
									<script type="text/javascript">
										datePickerValid( 'attr$attribute.id' );
									</script>                 
								#elseif( $attribute.valueType == "COMBO" )
									<select  id="attr$attribute.id"  name="attr$attribute.id" class=' #validate( "default"  $attribute.mandatory )'>
										 <option value="">[$i18n.getString( "please_select" )]</option>
									#foreach ($option in $attribute.attributeOptions )
										<option value="$option.id" #if($attributeValue == $option.name) selected="selected" #end>$option.name</option>
									#end
									</select>
								#else 
									<input type="text"  id="attr$attribute.id" name="attr$attribute.id" value="$!attributeValue" class="{validate:{required:$attribute.mandatory #if($!attribute.noChars),maxlength:$attribute.noChars #end #if($attribute.valueType=='NUMBER'),number:true #end }}" >
								#end
							</td>		
						</tr>
					#end
				#end
			#end
		#else		
		
		<tr><th colspan="2" class="heading-column">$attributeGroup.name</th></tr>
			#foreach($attribute in $attributeGroup.attributes )
				#if( $!attribute && $attribute.program )
				#elseif( $!attribute )
					#set( $attributeValue = "" )
					#set( $attributeValue = $!patientAttributeValueMap.get( $attribute.id ) )
					<tr>
						<td class='text-column'><label>$attribute.name #if($attribute.mandatory)<em title="$i18n.getString( "required" )" class="required">*</em> #end</label></td>
						<td class="input-column">
							#if( $attribute.valueType == "YES/NO" )
								<select id="attr$attribute.id"  name="attr$attribute.id" >              
									<option value="">[$i18n.getString( "please_select" )]</option>
									<option value="true" #if( $attributeValue=='true') selected="selected" #end>$i18n.getString( "yes" )</option>
									<option value="false" #if( $attributeValue=='false') selected="selected" #end>$i18n.getString( "no" )</option>
								</select>                
							#elseif( $attribute.valueType == "DATE" )
								<input type="text" id="attr$attribute.id" name="attr$attribute.id" value="$!attributeValue" class=' #validate( "default"  $attribute.mandatory )'>
								<script type="text/javascript">
									datePickerValid( 'attr$attribute.id' );
								</script>                 
							#elseif( $attribute.valueType == "COMBO" )
								<select  id="attr$attribute.id"  name="attr$attribute.id" class=' #validate( "default"  $attribute.mandatory )'>
									 <option value="">[$i18n.getString( "please_select" )]</option>
								#foreach ($option in $attribute.attributeOptions )
									<option value="$option.id" #if($attributeValue == $option.name) selected="selected" #end>$option.name</option>
								#end
								</select>
							#else 
								<input type="text"  id="attr$attribute.id" name="attr$attribute.id" value="$!attributeValue" class="{validate:{required:$attribute.mandatory #if($!attribute.noChars),maxlength:$attribute.noChars #end #if($attribute.valueType=='NUMBER'),number:true #end }}" >
							#end
						</td>		
					</tr>
				#end
			#end
		#end
		
	#end	
	<tr><td>&nbsp;</td></tr>

	<tr>
		<td></td>
		<td>
			<input type="submit" class='button' value="$i18n.getString( 'update' )" >
			<input type="button" class='button' value="$i18n.getString( 'back_to_registration' )" onclick="javascript:callAction( 'selectASHA' )"/>
		</td>
	</tr>
</table>

</form> 	

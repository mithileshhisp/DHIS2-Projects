#macro( validate $type $require )
  #if( $type == "NUMBER" )
  	{validate:{ number:true #if($require), required:true #end }}
  #elseif( $type == "string" )
  	{validate:{ alphanumeric:true #if($require), required:true #end }}
  #elseif( $require )
  	{validate:{required:true}}
  #end
#end

<script>
	
	jQuery(document).ready(	function(){

		datePickerValid( 'updateASHAProfileForm [id=deathDate]' );
		addEventForASHAForm('updateASHAProfileForm');
		
		jQuery("#updateASHAProfileForm").validate({
			 meta:"validate"
			,errorElement:"span"
			,submitHandler: function(form)
				{
					validateUpdateASHAProfile();
				}
			,beforeValidateHandler: function(form)
				{
					var dobType = $('#updateASHAProfileForm [id=dobType]').val();
					if( dobType=='V' || dobType=='D' ) 
					{
						var birthDate = $('#updateASHAProfileForm [id=birthDate]').val();
						if( birthDate != '' ){
							$("#updateASHAProfileForm [id=memberValidator]").val(birthDate);
						}
					}else{
						var age = $('#updateASHAProfileForm [id=age]').val();
						$("#updateASHAProfileForm [id=memberValidator]").val(age);
					}
				}
		});
		
		checkedDuplicate = false;
		if("$!patient.dobType" == 'A'){ 
			//var i18n_please_select_relationshipType = '$encoder.jsEscape( $i18n.getString( "please_verify_birthday" ) , "'")';
			//jQuery('#patientForm [id=birthDate]').css("display","none");
			//alert(i18n_please_select_relationshipType);
		}
		else{
			datePickerValid( 'updateASHAProfileForm [id=birthDate]' );
			jQuery('#updateASHAProfileForm [id=age]').css("display","none");
		}
	});
	
</script>

<h4>$i18n.getString( "update_asha" ) $!attributeGroup.name  $i18n.getString( "details" )</h4>
<p>
<form id="updateASHAProfileForm" name="updateASHAProfileForm" action="updatePatient.action" method="post" >

<input type="hidden" id="attributeGroupId" name="attributeGroupId" value="$attributeGroup.id">
<input type="hidden" id="attributeGroupName" name='attributeGroupName' value="$!attributeGroup.name"/>
<input type="hidden" id="id" name="id" value="$patient.id">
<!--
<input type="hidden" id="representativeId" name="representativeId" value='$!patient.representative.id' /> 
<input type="hidden" id="relationshipTypeId" name='relationshipTypeId' value="$!relationship.relationshipType.id"/>
<input type="hidden" id="id" name="id" value="$patient.id">
-->
<table>		
	<tr>
		<th colspan="2" class="heading-column">$i18n.getString( "system_identifier" )</th>
	</tr>	
	<tr>
		<td></td>
		<td>$!systemIdentifier</td>
	</tr>
	<tr>
		<td>&nbsp;</td>
	</tr>	

	<tr>
		<th colspan="2" class="heading-column">$i18n.getString( "asha_details" )</th>
	</tr>
	
	<tr>
		<td class='text-column'><label for="fullName">$i18n.getString( "full_name" )</label></td>
		<td class="input-column"><input type="text" id="fullName" name="fullName" value="$!patient.getFullName()" class="{validate:{required:true, unicodechars:true, rangelength:[7,50]}}"></td>
	</tr>
	
	<tr style='display:none'>
		<td class='text-column'><label for="gender">$i18n.getString( "gender" )<em title="$i18n.getString( "required" )" class="required">*</em></label></td>
		<td class="input-column">
			<select id="gender" name="gender">
				<option value="M" #if( $!patient.gender == 'M' ) selected="selected" #end>$i18n.getString( "male" )</option>
				<option value="F" #if( $!patient.gender == 'F' ) selected="selected" #end>$i18n.getString( "female" )</option>
			</select>
		</td>
	</tr>
	
	<tr>
		<td class='text-column' ><label for="birthDate">$i18n.getString( "date_of_birth" )<em title="$i18n.getString( 'required' )" class="required">*</em></label></td>
		<td class="input-column">
			<select id='dobType' name="dobType" style='width:120px' onchange='dobTypeOnChange("updateASHAProfileForm")' >
				<!--<option value="V" #if($patient.dobType=='V') selected #end >$i18n.getString( "verified" )</option>-->
				<option value="D" #if($patient.dobType=='D') selected #end >$i18n.getString( "declared" )</option>
				<option value="A" #if($patient.dobType=='A') selected #end >$i18n.getString( "approximated" )</option>
			</select>
			<input type="text" id="birthDate" name="birthDate" value='$format.formatDate($!patient.birthDate)' style='width:136px;' />
			<input type="text" id="age" name="age" placeholder="Enter age in years..." value='$!patient.getIntegerValueOfAge()' class="{validate:{number:true}}" style='width:136px;' />
		</td>
	</tr>

	<tr style='display:none'>
		<td></td>
		<td class="input-column">
			<input id="memberValidator" class="hidden {validate:{required:true}}"/>
		</td>
	</tr>
	
	<tr>
		<td class='text-column'><label for="phoneNumber">$i18n.getString( "phoneNumber" )</label></td>
		<td class="input-column">
			<input type="text" id="phoneNumber" name="phoneNumber" value="$!patient.phoneNumber" />
		</td>
	</tr>

<!-- ATTRIBUTES IN GROUPS -->
	#if( $!attributeGroup )
			<tr><td>&nbsp;</td></tr>	
			<tr><th colspan="2" class="heading-column">$attributeGroup.name</th></tr>
			#foreach($attribute in $attributeGroup.attributes )
				#if( $!attribute && $attribute.program )
				#elseif( $!attribute )
					#set( $attributeValue = "" )
					#set( $attributeValue = $!patientAttributeValueMap.get( $attribute.id ) )
					<tr>
						<td class='text-column'><label>$attribute.name #if($attribute.mandatory)<em title="$i18n.getString( "required" )" class="required">*</em> #end</label></td>
						<td class="input-column">
							#if( $attribute.valueType == "YES/NO" )
								<select id="attr$attribute.id"  name="attr$attribute.id" >              
									<option value="">[$i18n.getString( "please_select" )]</option>
									<option value="true" #if( $attributeValue=='true') selected="selected" #end>$i18n.getString( "yes" )</option>
									<option value="false" #if( $attributeValue=='false') selected="selected" #end>$i18n.getString( "no" )</option>
								</select>                
							#elseif( $attribute.valueType == "DATE" )
								<input type="text" id="attr$attribute.id" name="attr$attribute.id" value="$!attributeValue" class=' #validate( "default"  $attribute.mandatory )'>
								<script type="text/javascript">
									datePickerValid( 'attr$attribute.id' );
								</script>                 
							#elseif( $attribute.valueType == "COMBO" )
								<select  id="attr$attribute.id"  name="attr$attribute.id" class=' #validate( "default"  $attribute.mandatory )'>
									 <option value="">[$i18n.getString( "please_select" )]</option>
								#foreach ($option in $attribute.attributeOptions )
									<option value="$option.id" #if($attributeValue == $option.name) selected="selected" #end>$option.name</option>
								#end
								</select>
							#else 
								<input type="text"  id="attr$attribute.id" name="attr$attribute.id" value="$!attributeValue" class="{validate:{required:$attribute.mandatory #if($!attribute.noChars),maxlength:$attribute.noChars  #elseif($attribute.valueType=='NUMBER'),number:true #elseif($attribute.valueType=='TEXT'),unicodechars:true #end }}" />
							#end
						</td>		
					</tr>
				#end
			#end
	#end	
	<tr><td>&nbsp;</td></tr>

	<tr>
		<td></td>
		<td>
			<input type="submit" class='button' value="$i18n.getString( 'update' )" >
			<input type="button" class='button' value="$i18n.getString( 'back_to_registration' )" onclick="javascript:callAction( 'getRegisteredASHAList' )"/>
		</td>
	</tr>
</table>

</form> 	
<script>

	dobTypeOnChange("updateASHAProfileForm");	
</script>	

// icmr_leprosy_nikushtha_database_warFile_version_2.28_22062021 
// backup shared by ICMR Team
https://ln3.hispindia.org/owncloud/index.php/s/ojZQx1LPvUgav8Q


maharashtra server backup with backup script and analytics scripts
1) dhis2-home folder
2) mh_birt folder inside tomcat webapps folder
3) database backup scripts which are enable in schedular"
measles
https://ln3.hispindia.org/owncloud/index.php/s/yTMZIPZ5BUX9gB4

maharashtra server war file backup and database as on 15/04/2021

https://ln3.hispindia.org/owncloud/index.php/s/nIULPVLxmoVzfZm

maharashtra server only war file backup as on 05/05/2021 final update to new server http://115.124.111.208/mh/

https://ln3.hispindia.org/owncloud/index.php/s/QpX928qgDxBUpnw

database full backup on new server http://115.124.111.208/mh/
db size as on 10/05/2021 – 684 GB

// HP production 2.7 database backup ownCloud link
https://ln3.hispindia.org/owncloud/index.php/s/xaw3PCKJGZXIYMO

// HP-2.7-Production-War-File-Folder-Link ownCloud
https://ln3.hispindia.org/owncloud/index.php/s/PP52cT7PLtQLZxh


How to Connect to an SSH Server from Windows, macOS, or Linux
https://www.howtogeek.com/311287/how-to-connect-to-an-ssh-server-from-windows-macos-or-linux/


ssh username@ssh.server.com -p 2222
ssh your_username@host_ip_address //If the username on your local


ssh user@rci.med.kg  or
ssh user@rci.med.kg -p 22
username -- user
password -- User-RCI@


scp -r dbbackup 172.105.47.164:/mithilesh/

// Cpanel @hisp india

Password changed now
U/N;-johnlewi
Password:-Cp@n4l@H1Sp21 ( update on 23/06/2021 )

// for kyrgyzstan
scp dhis bhuvneshwar@172.105.47.164:/tmp/
scp -p 22 dhis bhuvneshwar@172.105.47.164:/tmp/

// kyrgyzstan dhis.conf file

dhis.conf  files  logs
root@user:/home/dhis/tomcat_kyrgyzstan/dhis2# cat dhis.conf
# Hibernate SQL dialect
connection.dialect = org.hibernate.dialect.PostgreSQLDialect

# JDBC driver class
connection.driver_class = org.postgresql.Driver

# JDBC driver connection URL
connection.url = jdbc:postgresql:kyrgyzstan

# Database username
connection.username = dhis

# Database password
connection.password = User-RCI@

# Database schema behavior, can be validate, update, create, create-drop
connection.schema = update

# Encryption password (sensitive)
encryption.password = 123456

\c dbname username
\c kyrgyzstan dhis

update organisationunit set geometry = null where hierarchylevel = 3;
kyrgyzstan=> update organisationunit set geometry = null where hierarchylevel = 3;
UPDATE 52
kyrgyzstan=>



https://www.linux.com/topic/desktop/how-securely-transfer-files-between-servers-scp/
https://kb.iu.edu/d/agye


Syntax:


scp <source> <destination>
To copy a file from B to A while logged into B:
scp /path/to/file username@a:/path/to/destination


To copy a file from B to A while logged into A:
scp username@b:/path/to/file /path/to/destination
scp mithilesh@172.105.47.164:/mithilesh/kyrgyzstan /



// create user on poatgres
CREATE USER fpaidbpro WITH PASSWORD fpaidbpro@9876 
GRANT ALL PRIVILEGES ON DATABASE fpaidb_pro to fpaidbpro;




https://www.youtube.com/watch?v=p3zWNFp1Wug&feature=youtu.be


https://dhis2.org/
// software overview
https://dhis2.org/overview/
// server setup


// windows


http://dhis-2.blogspot.com/2015/06/dhis2-local-installation-guide-for.html


// ubantu


http://dhis2trainingland.com/eportal/?tutorial=dhis2-installation-on-ubuntu-19-04-lts-digital-ocean


https://docs.dhis2.org/master/en/implementer/html/install_server_setup.html


https://docs.dhis2.org/2.30/en/implementer/html/install_server_setup.html


These are the following reference ( document ) links for our server-setup guide which is very helpful for doing work with our organisation. 
You go through the link and try to understand.


1) https://dhis2.org/


2) Software overview
   https://dhis2.org/overview/


3) Server setup
  a) for windows
    http://dhis-2.blogspot.com/2015/06/dhis2-local-installation-guide-for.html


  b) for ubuntu
      http://dhis2trainingland.com/eportal/?tutorial=dhis2-installation-on-ubuntu-19-04-lts-digital-ocean
      https://docs.dhis2.org/master/en/implementer/html/install_server_setup.html
      https://docs.dhis2.org/2.30/en/implementer/html/install_server_setup.html


4) This is the youtube video  presented by Bob ( University of Oslo ) . This is very useful.
      https://www.youtube.com/watch?v=p3zWNFp1Wug&feature=youtu.be






https://www.guru99.com/the-vi-editor.html




// plan AWS database link


Production

https://me.yesdigital.org/yesdigital/
Database server        // direct connect via pgAdmin not Putty/tunnel                                
Link -- http://yesme-db-instance-1.ckqpweusoamy.ap-southeast-1.rds.amazonaws.com/        
IP - 18.138.45.89        
Port - 5432        
databaseUserName - AdminUser        
password - YesmeProdDB        
databaseName - dhis2db


Testing        
https://training-me.yesdigital.org/yesdigital/


IP -- 13.228.129.104        
Port -- 5432        
databaseUserName -- postgres        
password -- YesmeTraining        
databaseUserName -- dhisdb


// ippf Bangladesh

IP Address:  202.53.172.118
port -- 22
User:  fpab
Password:  agni@fpab
newPassword : A$gni@fpab21 ( update on 22/06/2021 )

// ippf Bangladesh
http://fpabmis.org.bd/fpab/dhis-web-commons/security/login.action
http://202.53.172.118/fpab/dhis-web-dashboard/#/

// IPPF Sri Lanka -- 2.34
https://dhis2.fpasrilanka.org/fpasl/
IP Address:  124.43.10.78
port -- 22
User:  fpasl
Password:  Crtsl@#me077
newPassword : Crtsl@#me0621 ( update on 22/06/2021 )

// IPPF Afga -- 2.34
http://afgamis.org/afga/
IP -- 172.104.175.204
port -- 22
User:  fpasl
Password:  H@!$#S@!P
newPassword : M@!$#S@21 ( update on 22/06/2021 )


// IPPF Nepal -- 2.34
https://fpanmis.org/fpanpro/dhis-web-commons/security/login.action
IP -- 139.162.2.39
User:  mithilesh
Password:  M!th!lesh@123


// orissa ownCloud backup
https://ln3.hispindia.org/owncloud/index.php/s/MX5yKwTrd5t8e3m


orissa new production server detail file pasword


Dhis#123


// bihar ownCloud backup
https://ln3.hispindia.org/owncloud/index.php/s/F1acrTdLDHsyVXZ

// bihar my-sql

// MY-sql -- ln3 bihar dhis2 v2.7
new/connection -- 172.105.57.28
MySQL Host Address -- 172.105.57.28
username -- root
port -- 3306
password -- mysql@4535
database name - dhis_bihar

// HP production 2.7 database backup ownCloud link
https://ln3.hispindia.org/owncloud/index.php/s/xaw3PCKJGZXIYMO
// HP my-sql

// MY-sql -- ln3 HP dhis2 v2.7
new/connection -- 172.105.57.28
MySQL Host Address -- 172.105.57.28
username -- root
port -- 3306
password -- mysql@4535
database-name -- hp_dhisv27


HP Physical server Details ( Office )

hp server IP -- 119.82.76.2
port - 5001
root password -- logic.com

login in mysql - 

mysql -u root -p

Database	mysql	
user name	root	logic.ocm
database-name	dhis_hp_v27	
SHOW DATABASES;

login - password --logic.com
open terminal
ls
cd tomacat

sudo ./bin/shutdown.sh
sudo ./bin/startup.sh



// up - AWS


Host upapp
#HostName 13.233.135.186
HostName 13.235.37.126
User bobj


Host updb
#HostName 13.234.10.28
HostName 15.206.240.85
User bobj


Re: Server details at hisp india


username -- mithilesh
password -- M!th!lesh@123


https://login.linode.com/login
https://cloud.linode.com/dashboard
user-name - mithilesh_thakur
password -- Sachch!da@123


// add users


https://cloud.linode.com/account/users
ict wale
https://cloud.linode.com/dashboard
user-name -- mithilesh_thakur1
password -- S@chch!da@123




process of database access of server


// postgres


open putty
write ip in session 
then go to SSH --> tunnel
write sourceport any like 5454
destination -- localhost:5432 then add then open


then login to terminal


now go to pgadmin
create server 
name any -- like -- hp_upgraded
port same as on tunnel 
databaseName -- and its password


// MY-sql --- hp-dhis2
open putty
write ip in session  -- 139.162.16.101 port -- 96
then go to SSH --> tunnel
write sourceport any like 5454
destination -- localhost:3306 then add then open

then login to terminal

username - hpnrhm
HP@(D9543H!$
db password -- sj^Dg*E(b@1#70


now go to sqlYog
create connection
name any -- new connection -- localhost
port same as on tunnel 
databaseName -- dhis_hp_v27 and its password




analytics tables generation script manually
bat file window
#!/bin/sh
curl "http://202.166.205.218/suaahara2/api/resourceTables/analytics?skipResourceTables=true&lastYears=2" -X POST -u admin:district 
linex


analytics


#!/bin/sh 
/usr/bin/curl "http://103.31.80.242:8080/greenstar_crm/api/resourceTables/analytics?skipResourceTables=true&lastYears=2" -X POST -u admin:district >/dev/null 2>&1




/usr/bin/curl "https://tracker.hivaids.gov.np/save-child-2.27/api/resourceTables/analytics?skipResourceTables=true&lastYears=20" -X POST -u hispdev:Devhisp@1 >/dev/null 2>&1




pg_dump -U postgres -d msf_23_07_2018 -T analytics* > C:\Users\HISP\Desktop\msf_updated_db.sql



pg_dump -U postgres -d dataBaseName  -T analytics* > C:\Users\HISP\Desktop\msf_updated_db.sql


// complete meta-data-backup postgres sql


pg_dump -U dhis -d DBNAME -T analytics* -T datavalue -T datavalueaudit > DBNAME.sql


// complete meta-data-backup my-sql sql


HP-2.7


mysqldump -u root --password='sj^Dg*E(b@1#70' dhis_hp_v27 attribute attributevalue categorycombo 
categorycombos_categories categorycombos_optioncombos categoryoptioncombo categoryoptioncombos_categoryoptions 
config_in configuration dataelement dataelementcategory dataelementcategoryoption dataelementgroup dataelementgroupmembers dataelementgroupsetmembers dataelementgroupset dataelementoperand dataentryform dataset datasetindicators datasetmembers datasetoperands datasetsource expression expressiondataelement expressionoptioncombo indicator indicatorattributevalues indicatorgroup indicatorgroupmembers indicatorgroupset indicatorgroupsetmembers indicatortype linelist_de_map linelistelement linelistelementoptions linelistgroup linelistgroupelements linelistsource linelistoption minmaxdataelement maintenancein optionset optionsetmembers organisationunit organisationunitattributevalues orgunitgroup orgunitgroupmembers orgunitgroupset orgunitgroupsetmembers orgunitlevel period periodtype report reportin reportsource section sectiondataelements sectiongreyedfields userattributevalues usergroup usergroupmembers userinfo usermembership usermessage userrole userroleauthorities userroledataset userrole_documents userrole_olapurls userrole_reports userrolemembers userrolereports users usersetting validationcriteria validationrule 
validationrulegroupmembers | gzip -9 > hp_meta_`date +%b-%d-%y`.sql.gz


hp - 2.7 SSL issue resolved by restart the nginx




// meta data backup mysql HP


mysqldump -u root --password='sj^Dg*E(b@1#70' dhis_hp_v27 attribute attributevalue categorycombo 
categorycombos_categories categorycombos_optioncombos categoryoptioncombo categoryoptioncombos_categoryoptions 
configuration dataelement dataelementcategory dataelementcategoryoption dataelementgroup dataelementgroupmembers dataelementgroupsetmembers dataelementgroupset dataelementoperand dataentryform dataset datasetindicators datasetmembers datasetoperands datasetsource expression expressiondataelement expressionoptioncombo indicator indicatorattributevalues indicatorgroup indicatorgroupmembers indicatorgroupset indicatorgroupsetmembers indicatortype linelist_de_map linelistelement linelistelementoptions linelistgroup linelistgroupelements linelistsource linelistoption minmaxdataelement maintenancein optionset optionsetmembers organisationunit organisationunitattributevalues orgunitgroup orgunitgroupmembers orgunitgroupset orgunitgroupsetmembers orgunitlevel period periodtype report reportin reportsource section sectiondataelements sectiongreyedfields userattributevalues usergroup usergroupmembers userinfo usermembership usermessage userrole userroleauthorities userroledataset userrole_documents userrole_olapurls userrole_reports userrolemembers userrolereports users usersetting validationcriteria validationrule 
validationrulegroupmembers | gzip -9 > hp_meta_`date +%b-%d-%y`.sql.gz








mysqldump -u root -p dhis_hp_v27 attribute attributevalue categorycombo 
categorycombos_categories categorycombos_optioncombos categoryoptioncombo categoryoptioncombos_categoryoptions 
configuration dataelement dataelementcategory dataelementcategoryoption dataelementgroup dataelementgroupmembers dataelementgroupsetmembers dataelementgroupset dataelementoperand dataentryform dataset datasetindicators datasetmembers datasetoperands datasetsource expression expressiondataelement expressionoptioncombo indicator indicatorattributevalues indicatorgroup indicatorgroupmembers indicatorgroupset indicatorgroupsetmembers indicatortype linelist_de_map linelistelement linelistelementoptions linelistgroup linelistgroupelements linelistsource linelistoption minmaxdataelement maintenancein optionset optionsetmembers organisationunit organisationunitattributevalues orgunitgroup orgunitgroupmembers orgunitgroupset orgunitgroupsetmembers orgunitlevel period periodtype report reportin reportsource section sectiondataelements sectiongreyedfields userattributevalues usergroup usergroupmembers userinfo usermembership usermessage userrole userroleauthorities userroledataset userrole_documents userrole_olapurls userrole_reports userrolemembers userrolereports users usersetting validationcriteria validationrule 
validationrulegroupmembers version > metaData.sql;






orissa-2.12


H3alt#345


orissa production
203.129.205.99


d drive / apps/ hibernate files


database backup -- F drive


database backup script automatic for dhis2


/*
@echo off
echo Starting Backup of Database: %1


For /f "tokens=2-4 delims=/ " %%a in ('date /t') do (set dt=%%c-%%a-%%b)
For /f "tokens=1-4 delims=:." %%a in ('echo %time%') do (set tm=%%a%%b%%c%%d)
set bkupfilename=%1 orissa_v212_%dt%.sql
echo Backing up to file: %bkupfilename%


mysqldump -u root --password=Or1$$@rooT orissa_v212 > F:\DB_Backup\DHIS\"%bkupfilename%"


F:
cd DB_Backup\DHIS


"C:\Program Files\7-Zip\7z.exe" a -tzip "%bkupfilename%.7z" "%bkupfilename%"


del "%bkupfilename%"


echo Backup Complete!
exit
*/




database backup script automatic for tracker


/*
@echo off
echo Starting Backup of Database: %1


For /f "tokens=2-4 delims=/ " %%a in ('date /t') do (set dt=%%c-%%a-%%b)
For /f "tokens=1-4 delims=:." %%a in ('echo %time%') do (set tm=%%a%%b%%c%%d)
set bkupfilename=%1 orissa_track_v28_%dt%.sql
echo Backing up to file: %bkupfilename%


f:
cd DB_Backup\Tracker


mysqldump -u root --password=Or1$$@rooT orissa_track_v28 > "%bkupfilename%"


"C:\Program Files\7-Zip\7z.exe" a -mx9 "%bkupfilename%.7z" "%bkupfilename%"


del "%bkupfilename%"




echo Backup Complete!
exit
*/




@echo off
echo Starting Backup of Database: %1


For /f "tokens=2-4 delims=/ " %%a in ('date /t') do (set dt=%%c-%%a-%%b)
For /f "tokens=1-4 delims=:." %%a in ('echo %time%') do (set tm=%%a%%b%%c%%d)
set bkupfilename=%1 orissa_v212_%dt%.sql
echo Backing up to file: %bkupfilename%


pg_dump -U postgres -d dataBaseName -T analytics* > > F:\DB_Backup\DHIS\"%bkupfilename%"






F:
cd DB_Backup\DHIS


"C:\Program Files\7-Zip\7z.exe" a -tzip "%bkupfilename%.7z" "%bkupfilename%"


del "%bkupfilename%"


echo Backup Complete!
exit














// meta-data-backup for orissa production instance
mysqldump -u root --password=Or1$$@rooT orissa_v212 categorycombo categorycombos_categories categorycombos_optioncombos categoryoptioncombo 
categoryoptioncombos_categoryoptions config_in configuration dataelement dataelementcategory dataelementcategoryoption dataelementgroup 
dataelementgroupmembers dataelementgroupsetmembers dataelementgroupset dataelementoperand dataentryform dataset datasetindicators datasetmembers 
datasetoperands datasetsource expression expressiondataelement expressionoptioncombo indicator indicatorattributevalues indicatorgroup 
indicatorgroupmembers indicatorgroupset indicatorgroupsetmembers indicatortype linelist_de_map linelistelement linelistelementoptions linelistgroup linelistgroupelements linelistsource linelistoption maintenancein optionset optionsetmembers organisationunit organisationunitattributevalues orgunitgroup orgunitgroupmembers orgunitgroupset orgunitgroupsetmembers orgunitlevel period periodtype report reportin reportsource section sectiondataelements sectiongreyedfields userattributevalues usergroup usergroupmembers userinfo usermembership usermessage userrole userroleauthorities userroledataset userrole_documents userrole_olapurls userrole_reports userrolemembers userrolereports users usersetting validationcriteria validationrule validationrulegroupmembers > H:\metadata\odisha_meta_13-Aug-2020.sql


// for RFC error fail to load meta data in tracker-capture
https://community.dhis2.org/t/failed-to-load-metadata-error/35916/2


add relaxedQueryChars="[,]" inside Connector


    <Connector port="8091" protocol="HTTP/1.1"
               connectionTimeout="20000"
               redirectPort="8443" relaxedQueryChars="[,]"/>


// for mixed content error add followings


Reference:
   <Connector port="8080" protocol="HTTP/1.1"
               connectionTimeout="20000"
               redirectPort="8443"
               relaxedQueryChars="[,]"
               proxyPort="443" scheme="https"/>


// for see logs of instance https://links.hispindia.org/plan_testing


login on servre using putty
0 0/5 * * * ?
ip - 172.105.47.164 port --96
user-name -- mithilesh
password -- M!th!lesh@123


then go to 
cd /var/dhis/
then ls
or


tail -f tomcat_plan/logs/catalina.out


// for show own 
pwd
for copy files source to destination


sudo cp -r /home/mithilesh/lmis_05112020.sql  /var/dhis/tomcat_plan/webapps/


for remove file


rm -rf lmis_05112020.sql ( file name )


// for move files to tmp folder
 sudo mv files /tmp/


login to postgres


sudo -s
su postgres
then 
psql


\l ( for list of database )
\q ( for exit )
exit


then write backup commands


exit ( for exit from postgres user)


for remove backup file


rm -rf ippf_234_07122020.sql




// for emro 2.33 / 45.79.54.176  -- 22 ict_gotamala
create database emro_v233;


create database emro_v233;
drop database emro_v233;
sudo -u postgres psql -c "create extension postgis;" emro_v233


ALTER DATABASE emro_v233 owner to dhis;




psql -U dhis emro_v233 < /home/mithilesh/emro_v233_19022021/emro_233_16022021.sql




// for emro 2.34 / 45.79.54.176  -- 22 ict_gotamala
create database emro_v234;
drop database emro_v234;
create database emro_v234;


// exit from postgres user then create extension
sudo -u postgres psql -c "create extension postgis;" emro_v234


psql -U dhis emro_v234 < /home/mithilesh/emro_v233_19022021/emro_233_16022021.sql
ALTER DATABASE emro_v234 owner to dhis;






connection.url = jdbc:postgresql:emro_v233




// for import database
create database ippf_v34;
psql -U dhis ippf_v34 < /home/mithilesh/mh_pg_metadata_12122020.sql


// 10/02/2021
create database ippf_fpab_v34;
psql -U dhis ippf_fpab_v34 < /home/mithilesh/ippf_fpab_v34_10022021.sql


pg_dump -U dhis -d ippf_fpab_v34 > /home/mithilesh/ippf_fpab_v34_25022021.sql


// for IPPF Bangladesh Server
IP 202.53.172.118 port -- 22


// for ln2
create database ippf_fpab_v34;
// exit from postgres user then create extension
sudo -u postgres psql -c "create extension postgis;" ippf_fpab_v34
ALTER DATABASE ippf_fpab_v34 owner to dhis;
psql -U dhis ippf_fpab_v34 < /home/fpab/ippf_fpab_v34_10022021.sql




create database ippf_fpan_v34;
ALTER DATABASE ippf_fpan_v34 owner to dhis;
// exit from postgres user then create extension
sudo -u postgres psql -c "create extension postgis;" ippf_fpan_v34
psql -U dhis ippf_fpan_v34 < /home/fpab/ippf_fpab_v34_10022021.sql




// ippf Afga
database name -- afga_db
password
pg_dump -U afgaadmin -d afga_db > /home/hisp/database_backup_v27_22032021/ippf_afga_v27_22032021.sql

//23/06/2021
pg_dump -U afgaadmin -d ippf_afga_v34 -T analytics* > /home/hisp/ippf_afga_v34_23062021.sql
// 28/06/2021
pg_dump -U afgaadmin -d ippf_afga_v34 -T analytics* > /home/hisp/ippf_afga_v34_28062021.sql

create database ippf_afga_v34;
ALTER DATABASE ippf_afga_v34 owner to dhis;
// exit from postgres user then create extension
sudo -u postgres psql -c "create extension postgis;" ippf_afga_v34
psql -U dhis ippf_afga_v34 < /home/fpab/ippf_fpab_v34_10022021.sql

//  ippf fpai

ippf_fpai_v34
pg_dump -U dhis -d ippf_fpai_v34 > /home/mithilesh/ippf_fpai_v34_18052021.sql


// update database on https://ln2.hispindia.org/ippf_dev
// 17/06/2021 replace db ippf_fpai_v34
create db for ippf_fpan_v234
create database ippf_fpan_v234;
ALTER DATABASE ippf_fpan_v234 owner to dhis;
// exit from postgres user then create extension
sudo -u postgres psql -c "create extension postgis;" ippf_fpan_v234
psql -U dhis ippf_fpan_v234 < /home/mithilesh/ippf_fpanpro_11062021.sql


// bhutan new server details

Private IP: 172.30.16.7
Public IP:43.230.208.145 
they have changed the pvt IP.....credentials remains same
this is the production IP...earlier was staging env

// for bhutan //24/03/2021
https://ln2.hispindia.org/druk_hepatitis
replace 2.34 war file and bhutan hmis metadata


create database druk_hepatitis_v34;
ALTER DATABASE druk_hepatitis_v34 owner to dhis;
// exit from postgres user then create extension
sudo -u postgres psql -c "create extension postgis;" druk_hepatitis_v34
psql -U dhis druk_hepatitis_v34 < /home/mithilesh/ippf_fpab_v34_10022021.sql

// bhutan production server database update -- 2.34
// 07/06/2021
create database hmis_new_v234;
ALTER DATABASE hmis_new_v234 owner to hmis;
// exit from postgres user then create extension
sudo -u postgres psql -c "create extension postgis;" hmis_new_v234
psql -U dhis hmis_new_v234 < /home/mithilesh/ippf_fpab_v34_10022021.sql


// fhi360 onhis v32
create database fhi360_onhis_v32;
ALTER DATABASE fhi360_onhis_v32 owner to dhis;
// exit from postgres user then create extension
sudo -u postgres psql -c "create extension postgis;" fhi360_onhis_v32


psql -U dhis fhi360_onhis_v32 < /home/fpab/ippf_fpab_v34_10022021.sql


// for fhi360 onhis -2.34 // 15/06/2021

create database fhi360_onhis_v34;
ALTER DATABASE fhi360_onhis_v34 owner to dhis;
// exit from postgres user then create extension
sudo -u postgres psql -c "create extension postgis;" fhi360_onhis_v34

psql -U dhis fhi360_onhis_v34 < /home/mithilesh/




// for bhutan hmis   http://ln1.hispindia.org/bhutanhmis
// work on 19/03/2021
old database name -- bhutanhmis
create database bhutanhmis_meta_v34;
ALTER DATABASE bhutanhmis_meta_v34 owner to dhis;
// exit from postgres user then create extension
sudo -u postgres psql -c "create extension postgis;" bhutanhmis_meta_v34


psql -U dhis bhutanhmis_meta_v34 < /home/fpab/ippf_fpab_v34_10022021.sql


psql  -U dhis -d bhutanhmis_meta_v34  -t datavalue < 
psql  -U dhis -d bhutanhmis_meta_v34  -t datavalueaudit < 


drop database bhutanhmis_meta_v34;




// for Saint Lucia in https://ln2.hispindia.org/sl_ehis/
database name sl_ehis
pg_dump -U dhis -d sl_ehis -T analytics* > /home/mithilesh/saint_lucia_ehis_v234_25032021.sql
old database name -- sl_ehis
create database sl_ehis_v35;
ALTER DATABASE sl_ehis_v35 owner to dhis;
// exit from postgres user then create extension
sudo -u postgres psql -c "create extension postgis;" sl_ehis_v35


psql -U dhis sl_ehis_v35 < /home/mithilesh/sain_lucua_ehis_v235_25032021/sl_ehis_v35_25032021.sql

// backup before update optionset
pg_dump -U dhis -d slehis_v35 -T analytics* > /home/mithilesh/saint_lucia_ehis_v235_27052021.sql
// backup after update optionset
pg_dump -U dhis -d slehis_v35 -T analytics* > /home/mithilesh/saint_lucia_ehis_v235_after_optionset_update_27052021.sql


// ippf nepal 
server IP - 139.162.2.39 port 22
database name - fpan_pro
pg_dump -U fpanpro -d fpanpro -T analytics* > /home/mithilesh/ippf_fpan_pro_28022021.sql
pg_dump -U fpanpro -d fpanpro -T analytics* > /home/mithilesh/ippf_fpanpro_11062021.sql

// for Copy Tanda pilot db and war to tanda dev instance
Tanda Pilot: http://172.105.47.158/amrhp_pilot/dhis-web-commons/security/login.action

Tanda dev: http://172.105.47.158/amrhp_dev/dhis-web-commons/security/login.action

pg_dump -U dhis -d amrhp_pilot_v234 -T analytics* > /home/mithilesh/amrhp_pilot_v234_02062021.sql

pg_dump -U dhis -d amrhp_dev_new -T analytics* > /home/mithilesh/amrhp_dev_2.30_backup_tomcat_war_file_02062021/amrhp_pilot_v234_02062021.sql

// for amr tanda dev instance   http://172.105.47.158/amrhp_dev/dhis-web-commons/security/login.action
// work on 03/06/2021
old database name -- amrhp_dev_new -- in 2.30
create database amrhp_dev_v234;
ALTER DATABASE amrhp_dev_v234 owner to dhis;
// exit from postgres user then create extension
sudo -u postgres psql -c "create extension postgis;" amrhp_dev_v234

psql -U dhis amrhp_dev_v234 < /home/mithilesh/amrhp_pilot_v234_02062021.sql

amrhp_dev.war  amrhp_pilot.war

mv amrhp_pilot.war amrhp_dev.war

// 03/06/2021
// work for upgrade who_measles from 2.33 to 2.36  https://links.hispindia.org/measles

who_measles
pg_dump -U dhis -d who_measles -T analytics* > /home/mithilesh/who_measles_v233_03062021.sql
update database and war file on 24/06/2021 for 2.36.1

old database name -- who_measles -- in 2.33
create database who_measles_v236;
ALTER DATABASE who_measles_v236 owner to dhis;
// exit from postgres user then create extension
sudo -u postgres psql -c "create extension postgis;" who_measles_v236

psql -U dhis who_measles_v236 < /home/mithilesh/amrhp_pilot_v234_02062021.sql


// IPPF Iran FHAI -- 172.105.63.251 -- port -- 22
username - dhis2
password - Admin@123
ALTER DATABASE dhis2db owner to dhis2user;

# ----------------------------------------------------------------------
# Database connection
# ----------------------------------------------------------------------

# JDBC driver class
connection.driver_class = org.postgresql.Driver

# Database connection URL
#connection.url = jdbc:postgresql:dhis2
connection.url = jdbc:postgresql:dhis2db


# Database username
connection.username = dhis2user

# Database password
connection.password = dhI$@123

# ----------------------------------------------------------------------
# Server
# ----------------------------------------------------------------------

# Enable secure settings if deployed on HTTPS, default 'off', can be 'on'
# server.https = on


dhis2db

// file size 
du -sh ippf_234_weeklyPeriod.sql
// disk space
df -h 


// database import
psql -U dhis mh_revamping_227 < /home/mithilesh/mh_pg_metadata_12122020.sql






drop database ifff_234;
pg_dump -U dhis -d ippf > ippf_234_07122020.sql


pg_dump -U fpan -d fpab > home/mithilesh/ippf_fpab_227_09022021.sql


pg_dump -U postgres -d uphmis > ippf_234_07122020.sql


// for change in dhis.config file


https://www.guru99.com/the-vi-editor.html


sudo vi dhis.config  then enter 
i
then do required change in file 
then 2 times esc button
then :wq!




drop database tibet;
tibet_v27


drop database tibet_v27;
create database tibet_v27;
create database tibet_test_v27;
drop database tibet_test_v27;
psql -U dhis tibet_test_v27 < /home/mithilesh/tibet_pro_metadata_03022021.sql;


create database nap_v33;
psql -U dhis nap_v33 < /home/mithilesh/mh_pg_metadata_12122020.sql


drop database hivtracker234;
drop database hivtrackerv34;
create database hivtrackerv34;
psql -U dhis hivtrackerv34 < /home/mithilesh/hiv_tracker_234_19012021.sql;




// database backup on 25/06/2021 for event myanmar_hmis_new 2.33
pg_dump -U dhis  -d myanmar_hmis_new -T analytics* > /home/mithilesh/myanmar_hmis_new_v233_only_event_25062021.sql;

pg_dump -U dhis  -d myanmar_hmis_new -T analytics* > /home/mithilesh/hmis_new_database_backup/myanmar_hmis_new_v233_21032021.sql;
pg_dump -U dhis  -d myanmar_hmis_new -T analytics* > /home/mithilesh/myanmar_hmis_new_v233_15062021.sql;

pg_dump -U dhis  -d amr -T analytics* > /home/mithilesh/amr_230_03022021.sql;


pg_dump -U dhis  -d hivtracker_new  -T analytics* > /home/mithilesh/hivtracker_234_30012021.sql;


pg_dump -U dhis  -d mh_pg  -T analytics* -T datavalue -T datavalueaudit > /home/mithilesh/mh_pg_v27_metadata_30012021.sql;


pg_dump -U dhis  -d bhutanhmis  -T analytics* -T datavalue -T datavalueaudit > /home/mithilesh/bhutanhmis_metadata_v34_14022021.sql;


create database covid_epiv33;


psql -U dhis covid_epiv33 < /home/mithilesh/myanmar_covid_epi_orghierarchy_21012021.sql
pg_dump -U dhis  -d covid_epiv33  -T analytics* > /home/mithilesh/covid_epiv33_26012021.sql;


pg_dump -U dhis  -d ict_kenya -T analytics* > /home/mithilesh/ict_kenya_02022021.sql;
ict_kenya


pg_dump -U dhis  -d covid > /home/mithilesh/punjab_covid_234_23022021.sql;


create database covid_epi2v33;
psql -U dhis covid_epi2v33 < /home/mithilesh/myanmar_covid_epi_orghierarchy_21012021.sql


create database atm_dhis2_v33;
psql -U dhis atm_dhis2_v33 < /home


connection.url = jdbc:postgresql:covid_epiv33;


7z x hiv_tracker_234_20012021.7z
 


sudo -u postgres psql -c "create extension postgis;" hivtracker234




// database backup of who_measles


pg_dump -U dhis  -d measles -T analytics* > /home/mithilesh/who_measles_08032021_backup/who_measles_08032021.sql;


// database backup/dump


myanmar_hmis_new
pg_dump -U dhis -d DBNAME -T analytics* -T datavalue -T datavalueaudit > DBNAME.sql


pg_dump -U dhis -d myanmar_hmis_new -T analytics* -T datavalue -T datavalueaudit  > /home/mithilesh/myanmar_hmis_new_v233_metadata_15022021.sql


pg_dump -U dhis -d fhi360 > /home/mithilesh/backup_fhi360_23122020/backup_fhi360_23122020.sql


pg_dump -U fpanpro -d fpan_pro -T analytics* > /home/mithilesh/backup_fhi360_23122020/backup_fhi360_23122020.sql


pg_dump -U dhis -d hp_intpart > /home/mithilesh/hp_intpart_13012021.sql


pg_dump -U dhis -d dmc > /home/mithilesh/dmc_v33_18012021.sql


pg_dump -U dhis -d covid_epi > /home/mithilesh/covid_epi_21012021.sql


pg_dump -U dhis -d libya_traning_new -T analytics* > /home/mithilesh/libya_traning_new_17022021.sql
//
maharashtra pro database mata data backup script
pg_dump -U dhis -d mh_pg -T analytics* -T datavalue -T datavalueaudit > mh_pg_metadata_12122020.sql


// tibet meta-data database 
pg_dump -U dhis -d tibet_pro -T analytics* -T datavalue -T datavalueaudit > /home/hpnrhm/tibet_pro_metadata_03022021.sql


// rwandanew database backup


pg_dump -U dhis -d rwandanew > /home/mithilesh/rwandanew_29122020.sql




//plan-database backup server


login to server by putty bitwise
and go to 
cd/var 
ls
then go to dbbackup
again login to by bitwise
and write var
then dbbackup and copy backup


nginx details and restart restart
sudo /etc/init.d/nginx restart


sudo vim /etc/nginx/sites-available/
sudo vim /etc/nginx/sites-available/dhis




// for shutdown and restart in instance


ip - 139.162.61.147 port --96
user-name -- mithilesh
password -- M!th!lesh@123


then go to tocat location
 cd /home/hisp/
then 
./tomcat_kyrgyzstan/bin/


// for shutdown
sudo ./tomcat_kyrgyzstan/bin/shutdown.sh
sudo -u mithilesh ./tomcat_kyrgyzstan/bin/shutdown.sh

sudo -u mithilesh 

// for startup
sudo ./tomcat_kyrgyzstan/bin/startup.sh
sudo -u mithilesh ./tomcat_kyrgyzstan/bin/startup.sh


// for logs
sudo tail -f tomcat_kyrgyzstan/logs/catalina.out
sudo -u mithilesh tail -f fpanpro/logs/catalina.out




// login to servre


open putty
past IP and post
then open 
login in terminal ( username /password )
sudo -s
enter same password


// kenya sms service
cd /opt/ict4_cop_kenya/ict4cop_kenya_sms_service
node server.js


for check log
tail -f activity.log
// check node server.js running or not


ps aux|grep server.js


// disk space
df -h 


// for checking port is listen
grep -w 5432 /etc/services
grep -w 8010 /etc/services
 localyion of kenya/sms service


/opt/ict4cop_kenya/ict4cop_kenya_sms_service/server.js
// for kill the service // used for kenya SMS service
ps aux|grep server.js
sudo kill -9 5851


// list of cron set on servre


crontab –e


//Zubair Asghar Raja


whats app no - 004740332255




// libya production jira-link contanier


sudo lxc list


password for user


sudo lxc exec prodhis bash
cd /var
cd dhis


for copy files source to destination


sudo cp -r /home/mithilesh/lmis_05112020.sql  /var/dhis/tomcat_plan/webapps/


lxc file push -r my-dir container-name/any-path/


first copy to temp folder in container
sudo lxc file push -r /home/mithilesh/dhis-service-core-2.32.7.jar prodhis/tmp


then


sudo lxc exec prodhis bash


for see file
cd /tmp/
then ls
then sample copy
root@prodhis:/tmp# cp -r dhis-service-core-2.32.7.jar /var/dhis/tomcat_libya/webapps/libya/WEB-INF/lib/


then


root@prodhis:/var/dhis# ./tomcat_libya/bin/shutdown.sh


// copy from container to tmp
sudo cp -r /var/dhis/tomcat_libya/webapps/ /tmp/




OpenJDK 64-Bit Server VM warning: ignoring option MaxPermSize=512m; support was removed in 8.0
Tomcat stopped.


root@prodhis:/var/dhis# ./tomcat_libya/bin/startup.sh
Tomcat started.
root@prodhis:/var/dhis#




lxc file pull container-name/any-path/my-file 






sudo ./tomcat_libya/bin/shutdown.sh


// for startup
sudo ./tomcat_libya/bin/startup.sh
// for logst
sudo tail -f tomcat_libya/logs/catalina.out


// 


database name


openimisdemo


create new instance of // 29/12/2020
NAP        
version - dhis2.33        
link https://ln1.hispindia.org/nap        
tomcat-name inside tomcat_rwanda_new        
database-name nap_v33


create new instance of // 27/01/2021
NAP        
version - dhis2.33        
link https://ln1.hispindia.org/dhis_moh        
tomcat-name inside tomcat_dhis_moh                
database-name covid_epi2v33


// postgres database size query
SELECT pg_size_pretty( pg_database_size('mh_227_30_01_2021') );
SELECT pg_size_pretty( pg_database_size('myanmar_hmis_20_05_2021') );

// create user on poatgres
CREATE USER fpaidbpro WITH PASSWORD fpaidbpro@9876; 
ALTER USER fpidbpro WITH SUPERUSER;
GRANT ALL PRIVILEGES ON DATABASE fpaidb_pro to fpaidbpro;


CREATE USER fpidbpro WITH PASSWORD fpaidbpro@9876
ALTER USER fpidbpro WITH SUPERUSER;

GRANT ALL PRIVILEGES ON DATABASE fpaidb_pro to fpidbpro;

// give permisson to postgres user like /dhis/hmis

nano /etc/postgressql/13/main/pg_hba.cong
add
local   all   hmis  md5openimisdemo_v233_09_04_2021

then ctrl + X then Y ( for saving )

then restart the postgres

and for database on another server add following in 
nano /etc/postgressql/13/main/pg_hba.cong

host all all all all

host    all  	    all  	xxx.xxx.xxx.xxx       md5
host    all  	    all  	all                   md5

And then restart the Service
connect to postgres through command line

psql -U postgres -h localhost
or go through to C:\Program Files\PostgreSQL\10\bin\psql.exe

list of database
\list or \l+
\d+ // for all tables for selected database
select version();
\! psql -V
// move to database

\connect dbname or \c dbname
\d+  // list of tables
and run the sql script as required

// connect on server linode

// login to postgres
sudo -s
su postgres 
psql
// to connect the database
\c dbname username
psql dbname username
 \c dmc dhis  or \connect dbname username

\d+  // list of tables
and run the sql script as required


// postgres restart


sudo /etc/init.d/postgresql restart
//post gis extension creation
create extension if not exists postgis;
// create extension for database


sudo -u postgres psql -c "create extension postgis;" dhis2


//sudo service postgresql restart


nginx details and restart restart
sudo /etc/init.d/nginx restart


sudo vim /etc/nginx/sites-available/
sudo vim /etc/nginx/sites-available/dhis


// for view environment-variable go to location


/home/dhis/tomcat/bin$ cat setenv.sh

// rename file command


sudo mv ippf_v234_16032021.war ippf.war


sudo mv ippf.war fpab.war


sudo mv oldnamefile1 newnamefile1

// enable port on server ubantu
sudo ufw allow 3000



// work
// setup done on 19/05/2021 	for version-v2.34
New Database server for production instance
 
create database ippf fpaidb_pro;
ALTER DATABASE fpaidb_pro owner to fpaidbpro;
sudo -u postgres psql -c "create extension postgis;" fpaidb_pro

psql -U fpaidbpro fpaidb_pro < /home/mithilesh/ict_kenya_02022021.sql;

dhis.conf file
# Hibernate SQL dialect
connection.dialect = org.hibernate.dialect.PostgreSQLDialect

# JDBC driver class
connection.driver_class = org.postgresql.Driver

# JDBC driver connection URL
connection.url = jdbc:postgresql://192.168.1.175/fpaidb_pro

# Database username
connection.username = fpaidbpro

# Database password
connection.password = fpaidbpro@9876

# Database schema behavior, can be validate, update, create, create-drop
connection.schema = update

# Encryption password (sensitive)
#encryption.password = xxxx

// create user on poatgres
CREATE USER fpaidbpro WITH PASSWORD fpaidbpro@9876 
GRANT ALL PRIVILEGES ON DATABASE fpaidb_pro to fpaidbpro;

CREATE USER fpidbpro WITH PASSWORD fpaidbpro@9876
ALTER USER fpidbpro WITH SUPERUSER;

GRANT ALL PRIVILEGES ON DATABASE fpaidb_pro to fpidbpro;

// setevn.sh
export CATALINA_HOME=/home/fpaipro/tomcat7-pro/
export JAVA_HOME=/usr/lib/jvm/java-8-oracle
export DHIS2_HOME=/home/fpaipro/dhis_pro_home
export BIRT_HOME=/home/fpaipro/tomcat7-pro/webapps/birt_fpai/report
#xport BIRT_HOME=/home/hisp/tomcat_odisha/webapps/birt_odi/report/
#export CATALINA_PID=/home/fapipro/tomcat7-pro/work/fapipro.pid
export JAVA_OPTS="-Djava.awt.headless=true -Dfile.encoding=UTF-8 -server -Xms1024m -Xmx4096m -XX:MaxPermSize=1024m"

telnet <ip> <port>


// covid certificate server details

Kindly find below the credentials for SSH

IP: 172.104.57.34

Port: 221

User: root

Password: 73252300@Cross

rename file
mv oldnamefile1 newnamefile1
// load all files including hidden
ls -a
// kill port
sudo kill -9 `sudo lsof -t -i:3000`

// covid certificate

https://li1637-34.members.linode.com/epi/dhis-web-app-management/index.html
who
Aiham@@2021

base 64 encode/decode

https://www.base64encode.org/
http://172.104.57.34:3000/?19291
http://172.104.57.34:3000/?00012121212
172.104.57.34
port - 221
root
73252300@Cross
yarn
yarn start

apt install npm
npm install forever -g
forever start -c "yarn start" ./

forever start -c "yarn start" ./
forever stop -c "yarn start" ./

forever list
forever stopall 

// kill port
sudo kill -9 `sudo lsof -t -i:3000`
add .env file with below details
REACT_APP_AUTH='d2hvOkFpaGFtQEAyMDIx'




// new instance creation

// unzip the tomcat folder
tar -xvzf apache-tomcat-9.0.36.tar.gz

change mode for tomcat to root to dhis
chown -R dhis:dhis tomcat_data_portal/

/var/dhis# nginx -t
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful

// add in nginx
vim /etc/nginx/sites-available/ln2_ssl
// restart the nginx restart
/etc/init.d/nginx restart

// remove form tomcat
rm -rf docs/ examples/ host-manager/ manager/ ROOT/

 cd /var/dhis/
 1798  mv apache-tomcat-9.0.36 tomcat_data_portal
 1799  ls
 1800  su postgres
 1801  clear
 1802  ls
 1803  cd /home/mithilesh/ippf_
 1804  cd /home/mithilesh/
 1805  ls
// rename war file
 1806  mv dhis2-stable-2.36.0.war /var/dhis/tomcat_data_portal/webapps/
 1807  cd /var/dhis/
 1808  ls
 1809  s
 1810  ls
// copy env variable
 1811  cp -r tomcat_amr/bin/setenv.sh /var/dhis/tomcat_data_portal/bin/
// copy dhis.conf file
 1812  cp -r tomcat_amr/dhis2/dhis.conf /var/dhis/tomcat_data_portal/
 1813  cd tomcat_data_portal/
// create dhis-home directory
 1814  mkdir dhis2
// move dhis.conf file to dhis2 home
 1815  mv dhis.conf dhis2/
// update tomcat location in setenv.sh
 1816  vim bin/setenv.sh
 1817  cd ..
// update database name in dhis.conf
 1818  vim tomcat_data_portal/dhis2/dhis.conf
 1819  cd tomcat_data_portal/webapps/
 1820  s
 1821  ls
// rename war file
 1822  mv dhis2-stable-2.36.0.war data_portal.war
 1823  ls
// remove other folder from tomcat
 1824  rm -rf docs/ examples/ host-manager/ manager/ ROOT/
 1825  ls
 1826  cd ..
 1827  cd work/
 1828  ls
 1829  cd ..
 1830  ls
 1831  cd ..
// update port no on tomcat
 1832  vim tomcat_data_portal/conf/server.xml
// add tomcat entry in nginx
 1833  vim /etc/nginx/sites-available/ln2_ssl
// restart the nginx
 1834  /etc/init.d/nginx restart
 1835  nginx -t
 1836  ls
 1837  ls /home/
// change mode for permission of tomat 
 1838  chown -R dhis:dhis tomcat_data_portal/
 1839  cd tomcat_data_portal/
 1840  ll
 1841  cd ..
// restart tomcat from dhis user
 1842  sudo -u dhis tomcat_data_portal/bin/startup.sh
 1843  tail -f tomcat_data_portal/logs/catalina.out
 1844  nginx -t
 1845  history

// password update
sudo passwd username
Enter new UNIX password:
Retype new UNIX password:
passwd: password updated successfully

or
passwd
Changing password for abhishek.
(current) UNIX password: 
Enter new UNIX password: 
Retype new UNIX password: 
passwd: password updated successfully